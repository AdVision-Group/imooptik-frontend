{"version":3,"sources":["context/coupons/coupons.context.jsx"],"names":["CouponsContext","createContext","coupon","coupons","handleChange","getCoupon","getCoupons","createCoupon","deleteCoupon","isUpdating","resetCoupons","initCouponObj","code","type","value","maxUses","minValue","maxUsesTotal","CouponsProvider","children","useContext","LoadingModalContext","closeModal","getMessage","setIsLoading","setShowModal","token","AuthContext","push","useHistory","myHeaders","Headers","append","useState","setCoupon","setCoupons","setIsupdating","id","a","console","log","requestOptions","method","headers","redirect","fetch","process","response","json","data","message","couponToCreate","raw","JSON","stringify","undefined","Number","body","error","ok","Provider","e","target","name"],"mappings":"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","file":"static/js/26.30bec6c1.chunk.js","sourcesContent":["import React, { createContext, useContext, useState } from 'react'\nimport { LoadingModalContext } from '../loading-modal/loading-modal.contenxt'\nimport { AuthContext } from '../auth/auth.context'\nimport { useHistory } from 'react-router-dom'\n\nexport const CouponsContext = createContext({\n    coupon: null,\n    coupons: null,\n    handleChange: () => { },\n    getCoupon: () => { },\n    getCoupons: () => { },\n    createCoupon: () => { },\n    // updateCoupon: () => { },\n    deleteCoupon: () => { },\n    isUpdating: false,\n    resetCoupons: () => { }\n})\n\nconst initCouponObj = {\n    code: '',\n    type: 'percentage', // flat\n    value: 0,\n    maxUses: 0,\n    minValue: 0,\n    maxUsesTotal: 0\n}\n\n\nconst CouponsProvider = ({ children }) => {\n    const {\n        closeModal,\n        getMessage,\n        setIsLoading,\n        setShowModal\n    } = useContext(LoadingModalContext)\n    const { token } = useContext(AuthContext)\n    const { push } = useHistory()\n\n    const myHeaders = new Headers();\n    myHeaders.append(\"auth-token\", token);\n    myHeaders.append(\"Content-Type\", \"application/json\");\n\n    const [coupon, setCoupon] = useState(initCouponObj)\n    const [coupons, setCoupons] = useState(null)\n\n    const [isUpdating, setIsupdating] = useState(false)\n\n    const handleChange = (e) => {\n        const { name, value } = e.target\n\n        setCoupon({\n            ...coupon,\n            [name]: value\n        })\n    }\n\n    const getCoupon = async (id) => {\n        console.log(\"Get coupon\")\n        setIsupdating(true)\n        setIsLoading(true)\n        setShowModal(true)\n\n        const requestOptions = {\n            method: 'GET',\n            headers: myHeaders,\n            redirect: 'follow'\n        };\n\n        try {\n            const response = await fetch(`${process.env.REACT_APP_BACKEND_ENDPOINT}/api/admin/coupons/${id}`, requestOptions)\n            const data = await response.json()\n\n            if (data.coupon) {\n                setCoupon({\n                    ...coupon,\n                    ...data.coupon\n                })\n                closeModal()\n                return\n            }\n\n            getMessage(data.message)\n            setIsLoading(false)\n        } catch (err) {\n            console.log(err)\n            getMessage(\"Niečo sa pokazilo\")\n            setIsLoading(false)\n        }\n\n    }\n\n    const getCoupons = async () => {\n        console.log(\"Get coupons\")\n        setIsLoading(true)\n        setShowModal(true)\n\n        const requestOptions = {\n            method: 'GET',\n            headers: myHeaders,\n            redirect: 'follow'\n        };\n\n        try {\n            const response = await fetch(`${process.env.REACT_APP_BACKEND_ENDPOINT}/api/admin/coupons`, requestOptions)\n            const data = await response.json()\n\n            console.log(data)\n            if (data.coupons) {\n                setCoupons(data.coupons)\n            }\n            setIsLoading(false)\n            closeModal()\n        } catch (err) {\n            console.log(err)\n            getMessage(\"Niečo sa pokazilo\")\n            setIsLoading(false)\n        }\n    }\n\n    const createCoupon = async (couponToCreate) => {\n        console.log(\"Create coupon\")\n\n        setIsLoading(true)\n        setShowModal(true)\n\n        const raw = JSON.stringify({\n            code: couponToCreate.code,\n            type: couponToCreate.type, // flat\n            value: couponToCreate.value === '' || couponToCreate.value === '0' ? undefined : Number(couponToCreate.value),\n            maxUses: couponToCreate.maxUses === '' || couponToCreate.maxUses === '0' ? undefined : Number(couponToCreate.maxUses),\n            minValue: couponToCreate.minValue === '' || couponToCreate.minValue === '0' ? undefined : Number(couponToCreate.minValue),\n            maxUsesTotal: couponToCreate.maxUsesTotal === '' || couponToCreate.maxUsesTotal === '0' ? undefined : Number(couponToCreate.maxUsesTotal)\n        })\n\n        console.log(raw)\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n            redirect: 'follow'\n        };\n\n        try {\n            const response = await fetch(`${process.env.REACT_APP_BACKEND_ENDPOINT}/api/admin/coupons/create`, requestOptions)\n            const data = await response.json()\n\n            console.log(data)\n\n            if (data.error === \"format\") {\n                getMessage(\"Kód kupónu je povinný\")\n            }\n            if (data.error === 'exists') {\n                getMessage(\"Kupón už existuje\")\n            }\n\n            if (response.ok) {\n                getCoupons()\n                push('/dashboard/kupony')\n            }\n\n            // getMessage(data.message)\n            setIsLoading(false)\n        } catch (err) {\n            console.log(err)\n            getMessage(\"Niečo sa pokazilo\")\n            setIsLoading(false)\n        }\n\n    }\n\n    // const updateCoupon = async () => {\n    //     console.log(\"Update coupon\")\n\n    //     setIsLoading(true)\n    //     setShowModal(true)\n\n    //     const requestOptions = {\n    //         method: 'GET',\n    //         headers: myHeaders,\n    //         redirect: 'follow'\n    //     };\n\n    //     try {\n    //         const response = await fetch(`${process.env.REACT_APP_BACKEND_ENDPOINT}/api/admin/coupons/${id}`, requestOptions)\n    //         const data = await response.json()\n\n    //         getMessage(data.message)\n    //         setIsLoading(false)\n    //     } catch (err) {\n    //         console.log(err)\n    //         getMessage(\"Niečo sa pokazilo\")\n    //         setIsLoading(false)\n    //     }\n\n    // }\n\n    const deleteCoupon = async (id) => {\n        console.log(\"Delete coupon\")\n\n        setIsLoading(true)\n        setShowModal(true)\n\n        const requestOptions = {\n            method: 'DELETE',\n            headers: myHeaders,\n            redirect: 'follow'\n        };\n\n        try {\n            const response = await fetch(`${process.env.REACT_APP_BACKEND_ENDPOINT}/api/admin/coupons/${id}`, requestOptions)\n            const data = await response.json()\n\n            console.log(data)\n\n            if (response.ok) {\n                getCoupons()\n                push('/dashboard/kupony')\n            }\n            // getMessage(data.message)\n            setIsLoading(false)\n        } catch (err) {\n            console.log(err)\n            getMessage(\"Niečo sa pokazilo\")\n            setIsLoading(false)\n        }\n    }\n\n    const resetCoupons = async () => {\n        setIsupdating(false)\n        setCoupon(initCouponObj)\n    }\n\n    return (\n        <CouponsContext.Provider\n            value={{\n                coupon,\n                coupons,\n                handleChange,\n                getCoupon,\n                getCoupons,\n                createCoupon,\n                // updateCoupon,\n                deleteCoupon,\n                isUpdating,\n                resetCoupons\n            }}\n        >\n            {children}\n        </CouponsContext.Provider>\n    )\n}\n\nexport default CouponsProvider"],"sourceRoot":""}