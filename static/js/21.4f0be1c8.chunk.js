(this.webpackJsonpimooptik=this.webpackJsonpimooptik||[]).push([[21],{55:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var c=n(22);var o=n(33);function r(e){return function(e){if(Array.isArray(e))return Object(c.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(o.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},61:function(e,t,n){"use strict";n.r(t),n.d(t,"OrderContext",(function(){return f}));var c=n(2),o=n(7),r=n.n(o),s=n(12),a=n(55),u=n(21),d=n(10),i=n(1),l=n(18),b=n(19),f=Object(i.createContext)({step:"",order:{},cart:[],selectedProduct:null,setOrder:function(){},addUser:function(){},addProduct:function(){},addProductDiscount:function(){},addLensesParameters:function(){},deleteProduct:function(){},addLenses:function(){},addLensesDiscount:function(){},resetOrder:function(){},changeStep:function(){},selectProduct:function(){},createCombinedProducts:function(){}});t.default=function(e){var t=e.children,n=Object(i.useContext)(b.a).token,o=Object(i.useContext)(l.a),p=o.closeModal,O=o.getMessage,j=o.setIsLoading,m=o.setShowModal,h=Object(i.useState)("select-user"),P=Object(d.a)(h,2),g=P[0],v=P[1],y=Object(i.useState)({}),k=Object(d.a)(y,2),S=k[0],x=k[1],w=Object(i.useState)([]),A=Object(d.a)(w,2),C=A[0],L=A[1],M=Object(i.useState)(null),T=Object(d.a)(M,2),D=T[0],I=T[1],_=function(e){console.log("combinedProductsArr"),console.log(e),console.log("combinedProductsArr"),x(Object(u.a)(Object(u.a)({},S),{},{combinedProducts:Object(a.a)(e)}))},R=function(e){v(e)},J=function(){var e=Object(s.a)(r.a.mark((function e(){var t,c,o,s,a,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==C.length){e.next=2;break}return e.abrupt("return");case 2:return j(!0),m(!0),console.log("ORIGINAL CART"),console.log(C),t=C.map((function(e){return Object(u.a)(Object(u.a)(Object(u.a)(Object(u.a)({product:e.product.isPseudo?"pseudo":e.product._id},e.discount&&{discount:Object(u.a)({},e.discount)}),e.lens&&{lens:e.lens._id}),e.lens&&{lensesQuant:1}),e.lenses&&{contactLenses:e.lenses})})),console.log("FORMATED CART"),console.log(t),(c=new Headers).append("auth-token",n),c.append("Content-Type","application/json"),o=JSON.stringify({combinedProducts:t}),s={method:"POST",headers:c,body:o,redirect:"follow"},e.prev=14,e.next=17,fetch("".concat("http://195.110.58.166:8080","/api/store/combinedProducts/createMany"),s);case 17:return a=e.sent,e.next=20,a.json();case 20:if(d=e.sent,console.log(d),!d.combinedProducts){e.next=27;break}return _(d.combinedProducts),p(),R("summary"),e.abrupt("return");case 27:j(!1),O(d.messageSK),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(14),console.log(e.t0),O("Nieco sa pokazilo"),j(!1);case 36:case"end":return e.stop()}}),e,null,[[14,31]])})));return function(){return e.apply(this,arguments)}}();return Object(c.jsx)(f.Provider,{value:{step:g,order:S,cart:C,selectedProduct:D,setOrder:x,addUser:function(e){x(Object(u.a)(Object(u.a)({},S),{},{user:e}))},addProduct:function(e){L((function(t){return[].concat(Object(a.a)(t),[{product:e}])}))},addProductDiscount:function(e,t){if(""===t){var n=C.map((function(t,n){return e===n?Object.keys(t.discount).length>1?(delete t.discount.product,t):(delete t.discount,t):t}));L(n)}else{var c=C.map((function(n,c){return e===c?Object(u.a)(Object(u.a)({},n),{},{discount:{product:{percent:t}}}):n}));L(c)}},addLensesParameters:function(e,t){var n=C.map((function(n,c){return e===c&&Object.keys(t).length>0?Object(u.a)(Object(u.a)({},n),{},{lenses:Object(u.a)({},t)}):n}));L(n)},deleteProduct:function(e){console.log(e);var t=C.filter((function(t){return t.product._id!==e.product._id}));L(t)},addLenses:function(e){if(null!==D){var t=C.map((function(t,n){return n===D?Object(u.a)(Object(u.a)({},t),{},{lens:e}):t}));L(t)}else L((function(t){return[].concat(Object(a.a)(t),[{product:{_id:Math.floor(10*Math.random()),isPseudo:!0},lens:e}])}));I(null)},addLensesDiscount:function(e,t){if(""===t){var n=C.map((function(t,n){return e===n?Object.keys(t.discount).length>1?(delete t.discount.lenses,t):(delete t.discount,t):t}));L(n)}else{var c=C.map((function(n,c){return e===c?Object(u.a)(Object(u.a)({},n),{},{discount:Object(u.a)(Object(u.a)({},n.discount),{},{lenses:{percent:t}})}):n}));L(c)}},resetOrder:function(){x({})},changeStep:R,selectProduct:function(e){I(e)},createCombinedProducts:J},children:t})}}}]);
//# sourceMappingURL=21.4f0be1c8.chunk.js.map