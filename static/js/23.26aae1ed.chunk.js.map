{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","context/order/order.context.jsx"],"names":["_toConsumableArray","arr","Array","isArray","arrayLikeToArray","iter","Symbol","iterator","Object","from","unsupportedIterableToArray","TypeError","OrderContext","createContext","step","order","cart","selectedProduct","setOrder","addUser","addProduct","addProductDiscount","addLensesParameters","deleteProduct","addLenses","addLensesDiscount","resetOrder","changeStep","selectProduct","createCombinedProducts","incrementQuantity","decrementQuantity","OrderProvider","children","token","useContext","AuthContext","LoadingModalContext","closeModal","getMessage","setIsLoading","setShowModal","useState","setStep","setCart","setSelectedProduct","addCombinedProducts","combinedProductsArr","combinedProducts","newStepString","a","length","map","item","product","isPseudo","_id","discount","lens","lensesQuant","lenses","contactLenses","myHeaders","Headers","append","raw","JSON","stringify","requestOptions","method","headers","body","redirect","fetch","process","response","json","data","messageSK","console","log","Provider","value","user","productObj","prevValue","idx","newCart","index","keys","percent","lensesObj","productIdx","handleSelectProduct","filter","setTimeout","Math","floor","random","event","stopPropagation"],"mappings":"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","file":"static/js/23.26aae1ed.chunk.js","sourcesContent":["import arrayWithoutHoles from \"@babel/runtime/helpers/esm/arrayWithoutHoles\";\nimport iterableToArray from \"@babel/runtime/helpers/esm/iterableToArray\";\nimport unsupportedIterableToArray from \"@babel/runtime/helpers/esm/unsupportedIterableToArray\";\nimport nonIterableSpread from \"@babel/runtime/helpers/esm/nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"@babel/runtime/helpers/esm/arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import React, { createContext, useState, useContext } from 'react'\r\nimport { LoadingModalContext } from '../loading-modal/loading-modal.contenxt'\r\nimport { AuthContext } from '../auth/auth.context'\r\n\r\nexport const OrderContext = createContext({\r\n    step: \"\",\r\n    order: {},\r\n    cart: [],\r\n    selectedProduct: null,\r\n    setOrder: () => { },\r\n    addUser: () => { },\r\n    addProduct: () => { },\r\n    addProductDiscount: () => { },\r\n    addLensesParameters: () => { },\r\n    deleteProduct: () => { },\r\n    addLenses: () => { },\r\n    addLensesDiscount: () => { },\r\n    resetOrder: () => { },\r\n    changeStep: () => { },\r\n    selectProduct: () => { },\r\n    createCombinedProducts: () => { },\r\n    incrementQuantity: () => { },\r\n    decrementQuantity: () => { },\r\n})\r\n\r\nconst OrderProvider = ({ children }) => {\r\n    const { token } = useContext(AuthContext)\r\n    const { closeModal, getMessage, setIsLoading, setShowModal } = useContext(LoadingModalContext)\r\n    const [step, setStep] = useState('select-user')\r\n    const [order, setOrder] = useState({})\r\n    const [cart, setCart] = useState([])\r\n    const [selectedProduct, setSelectedProduct] = useState(null)\r\n\r\n    const addUser = (user) => {\r\n        setOrder({\r\n            ...order,\r\n            user: user\r\n        })\r\n    }\r\n\r\n    const addCombinedProducts = (combinedProductsArr) => {\r\n\r\n        setOrder({\r\n            ...order,\r\n            combinedProducts: [\r\n                // ...(order?.combinedProducts) && { ...order?.combinedProducts },\r\n                ...combinedProductsArr\r\n            ]\r\n        })\r\n    }\r\n\r\n    const selectProduct = (productIdx, event) => {\r\n        if (selectedProduct === productIdx) {\r\n            setSelectedProduct(null)\r\n        } else {\r\n            setSelectedProduct(productIdx)\r\n        }\r\n    }\r\n\r\n    const addProduct = (productObj) => {\r\n        setCart(prevValue => [\r\n            ...prevValue,\r\n            { product: productObj, }\r\n        ])\r\n    }\r\n\r\n    const addProductDiscount = (idx, value) => {\r\n        if (value === \"\") {\r\n            const newCart = cart.map((item, index) => {\r\n                if (idx === index) {\r\n                    if (Object.keys(item.discount).length > 1) {\r\n                        delete item.discount[\"product\"]\r\n                        return item\r\n                    } else {\r\n                        delete item[\"discount\"]\r\n                        return item\r\n                    }\r\n                } else {\r\n                    return item\r\n                }\r\n            })\r\n            setCart(newCart)\r\n        } else {\r\n            const newCart = cart.map((item, index) => {\r\n                if (idx === index) {\r\n                    return {\r\n                        ...item,\r\n                        discount: {\r\n                            product: {\r\n                                percent: value\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    return item\r\n                }\r\n            })\r\n            setCart(newCart)\r\n        }\r\n    }\r\n\r\n    const addLensesParameters = (idx, lensesObj) => {\r\n        const newCart = cart.map((item, index) => {\r\n            if (idx === index) {\r\n                if (Object.keys(lensesObj).length > 0) {\r\n                    return {\r\n                        ...item,\r\n                        lenses: {\r\n                            ...lensesObj\r\n                        }\r\n                    }\r\n                } else {\r\n                    return item\r\n                }\r\n            } else {\r\n                return item\r\n            }\r\n        })\r\n        setCart(newCart)\r\n    }\r\n\r\n    const deleteProduct = (productIdx, handleSelectProduct) => {\r\n        const newCart = cart.filter((item, idx) => idx !== productIdx)\r\n        setCart(newCart)\r\n        if (!handleSelectProduct) return\r\n        setTimeout(() => {\r\n            handleSelectProduct(null)\r\n\r\n        }, 100)\r\n    }\r\n\r\n    const addLenses = (lensesObj) => {\r\n        if (lensesObj === null && selectedProduct === null) return\r\n        if (selectedProduct !== null) {\r\n            const newCart = cart.map((item, idx) => {\r\n                if (idx === selectedProduct) {\r\n                    if (lensesObj === null) {\r\n                        delete item[\"lensesQuant\"]\r\n                        delete item[\"lens\"]\r\n                        return item\r\n                    } else {\r\n                        return ({\r\n                            ...item,\r\n                            lens: lensesObj,\r\n                            lensesQuant: 2\r\n                        })\r\n                    }\r\n                } else {\r\n                    return item\r\n                }\r\n            })\r\n            setCart(newCart)\r\n        } else {\r\n            setCart(prevValue => [\r\n                ...prevValue,\r\n                {\r\n                    product: {\r\n                        _id: Math.floor(Math.random() * 10),\r\n                        isPseudo: true\r\n                    },\r\n                    lens: lensesObj,\r\n                    lensesQuant: 1\r\n                }\r\n            ])\r\n        }\r\n\r\n        setSelectedProduct(null)\r\n    }\r\n\r\n    const incrementQuantity = (prevValue, idx, event) => {\r\n        event.stopPropagation()\r\n        const newCart = cart.map((item, index) => {\r\n            if (idx === index) {\r\n                return ({\r\n                    ...item,\r\n                    lensesQuant: prevValue + 1\r\n                })\r\n            } else {\r\n                return item\r\n            }\r\n        })\r\n        setCart(newCart)\r\n    }\r\n\r\n\r\n    const decrementQuantity = (prevValue, idx, event) => {\r\n        event.stopPropagation()\r\n\r\n        if (prevValue === 1) return\r\n        const newCart = cart.map((item, index) => {\r\n            if (idx === index) {\r\n                return ({\r\n                    ...item,\r\n                    lensesQuant: prevValue - 1\r\n                })\r\n            } else {\r\n                return item\r\n            }\r\n        })\r\n        setCart(newCart)\r\n    }\r\n\r\n\r\n    const addLensesDiscount = (idx, value) => {\r\n        if (value === \"\") {\r\n            const newCart = cart.map((item, index) => {\r\n                if (idx === index) {\r\n                    if (Object.keys(item.discount).length > 1) {\r\n                        delete item.discount[\"lenses\"]\r\n                        return item\r\n                    } else {\r\n                        delete item[\"discount\"]\r\n                        return item\r\n                    }\r\n                } else {\r\n                    return item\r\n                }\r\n            })\r\n            setCart(newCart)\r\n        } else {\r\n            const newCart = cart.map((item, index) => {\r\n                if (idx === index) {\r\n                    return {\r\n                        ...item,\r\n                        discount: {\r\n                            ...item.discount,\r\n                            lenses: {\r\n                                percent: value\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    return item\r\n                }\r\n            })\r\n            setCart(newCart)\r\n        }\r\n    }\r\n\r\n    const resetOrder = () => {\r\n        setOrder({})\r\n    }\r\n\r\n    const changeStep = (newStepString) => {\r\n        setStep(newStepString)\r\n    }\r\n\r\n    const createCombinedProducts = async () => {\r\n        if (cart.length === 0) return\r\n        setIsLoading(true)\r\n        setShowModal(true)\r\n\r\n        const combinedProductsArr = cart.map(item => ({\r\n            product: item.product.isPseudo ? \"pseudo\" : item.product._id,\r\n            ...(item.discount) && { discount: { ...item.discount } },\r\n            ...(item.lens) && { lens: item.lens._id },\r\n            ...(item.lensesQuant) && { lensesQuant: item.lensesQuant },\r\n            // ...(item.lens && order.user) && { lenses: order.user.lenses },\r\n            ...(item.lenses) && { contactLenses: item.lenses }\r\n        }))\r\n\r\n        const myHeaders = new Headers();\r\n        myHeaders.append(\"auth-token\", token);\r\n        myHeaders.append(\"Content-Type\", \"application/json\");\r\n\r\n\r\n        const raw = JSON.stringify({\r\n            combinedProducts: combinedProductsArr\r\n        })\r\n\r\n        const requestOptions = {\r\n            method: 'POST',\r\n            headers: myHeaders,\r\n            body: raw,\r\n            redirect: 'follow'\r\n        };\r\n\r\n        try {\r\n            // /api/store/combinedProducts/createMany\r\n            const response = await fetch(`${process.env.REACT_APP_BACKEND_ENDPOINT}/api/store/combinedProducts/createMany`, requestOptions)\r\n            const data = await response.json()\r\n\r\n            if (data.combinedProducts) {\r\n                addCombinedProducts(data.combinedProducts)\r\n                closeModal()\r\n                changeStep(\"summary\")\r\n                return\r\n            }\r\n\r\n            setIsLoading(false)\r\n            getMessage(data.messageSK)\r\n        } catch (err) {\r\n            console.log(err)\r\n            getMessage(\"Nieco sa pokazilo\")\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <OrderContext.Provider\r\n            value={{\r\n                step,\r\n                order,\r\n                cart,\r\n                selectedProduct,\r\n                setOrder,\r\n                addUser,\r\n                addProduct,\r\n                addProductDiscount,\r\n                addLensesParameters,\r\n                deleteProduct,\r\n                addLenses,\r\n                addLensesDiscount,\r\n                resetOrder,\r\n                changeStep,\r\n                selectProduct,\r\n                createCombinedProducts,\r\n                incrementQuantity,\r\n                decrementQuantity,\r\n            }}\r\n        >\r\n            {children}\r\n        </OrderContext.Provider>\r\n    )\r\n}\r\n\r\nexport default OrderProvider"],"sourceRoot":""}