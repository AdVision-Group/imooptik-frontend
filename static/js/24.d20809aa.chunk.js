(this.webpackJsonpimooptik=this.webpackJsonpimooptik||[]).push([[24],{56:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var c=n(22);var r=n(33);function o(e){return function(e){if(Array.isArray(e))return Object(c.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(r.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},66:function(e,t,n){"use strict";n.r(t),n.d(t,"OrderContext",(function(){return b}));var c=n(2),r=n(7),o=n.n(r),a=n(12),u=n(56),s=n(21),i=n(10),d=n(1),l=n(18),f=n(19),b=Object(d.createContext)({step:"",order:{},cart:[],selectedProduct:null,setOrder:function(){},addUser:function(){},addProduct:function(){},addProductDiscount:function(){},addLensesParameters:function(){},deleteProduct:function(){},addLenses:function(){},addLensesDiscount:function(){},resetOrder:function(){},changeStep:function(){},selectProduct:function(){},createCombinedProducts:function(){},incrementQuantity:function(){},decrementQuantity:function(){}});t.default=function(e){var t=e.children,n=Object(d.useContext)(f.a).token,r=Object(d.useContext)(l.a),p=r.closeModal,O=r.getMessage,j=r.setIsLoading,m=r.setShowModal,h=Object(d.useState)("select-user"),P=Object(i.a)(h,2),v=P[0],y=P[1],g=Object(d.useState)({}),k=Object(i.a)(g,2),S=k[0],Q=k[1],x=Object(d.useState)([]),w=Object(i.a)(x,2),L=w[0],C=w[1],M=Object(d.useState)(null),D=Object(i.a)(M,2),T=D[0],A=D[1],I=function(e){Q(Object(s.a)(Object(s.a)({},S),{},{combinedProducts:Object(u.a)(e)}))},J=function(e){y(e)},_=function(){var e=Object(a.a)(o.a.mark((function e(){var t,c,r,a,u,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==L.length){e.next=2;break}return e.abrupt("return");case 2:return j(!0),m(!0),t=L.map((function(e){return Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)({product:e.product.isPseudo?"pseudo":e.product._id},e.discount&&{discount:Object(s.a)({},e.discount)}),e.lens&&{lens:e.lens._id}),e.lensesQuant&&{lensesQuant:e.lensesQuant}),e.lenses&&{contactLenses:e.lenses})})),(c=new Headers).append("auth-token",n),c.append("Content-Type","application/json"),r=JSON.stringify({combinedProducts:t}),a={method:"POST",headers:c,body:r,redirect:"follow"},e.prev=10,e.next=13,fetch("".concat("http://195.110.58.166:8080","/api/store/combinedProducts/createMany"),a);case 13:return u=e.sent,e.next=16,u.json();case 16:if(!(i=e.sent).combinedProducts){e.next=22;break}return I(i.combinedProducts),p(),J("summary"),e.abrupt("return");case 22:j(!1),O(i.messageSK),e.next=31;break;case 26:e.prev=26,e.t0=e.catch(10),console.log(e.t0),O("Nieco sa pokazilo"),j(!1);case 31:case"end":return e.stop()}}),e,null,[[10,26]])})));return function(){return e.apply(this,arguments)}}();return Object(c.jsx)(b.Provider,{value:{step:v,order:S,cart:L,selectedProduct:T,setOrder:Q,addUser:function(e){Q(Object(s.a)(Object(s.a)({},S),{},{user:e}))},addProduct:function(e){C((function(t){return[].concat(Object(u.a)(t),[{product:e}])}))},addProductDiscount:function(e,t){if(""===t){var n=L.map((function(t,n){return e===n?Object.keys(t.discount).length>1?(delete t.discount.product,t):(delete t.discount,t):t}));C(n)}else{var c=L.map((function(n,c){return e===c?Object(s.a)(Object(s.a)({},n),{},{discount:{product:{percent:t}}}):n}));C(c)}},addLensesParameters:function(e,t){var n=L.map((function(n,c){return e===c&&Object.keys(t).length>0?Object(s.a)(Object(s.a)({},n),{},{lenses:Object(s.a)({},t)}):n}));C(n)},deleteProduct:function(e,t){var n=L.filter((function(t,n){return n!==e}));C(n),t&&setTimeout((function(){t(null)}),100)},addLenses:function(e){if(null!==e||null!==T){if(null!==T){var t=L.map((function(t,n){return n===T?null===e?(delete t.lensesQuant,delete t.lens,t):Object(s.a)(Object(s.a)({},t),{},{lens:e,lensesQuant:2}):t}));C(t)}else C((function(t){return[].concat(Object(u.a)(t),[{product:{_id:Math.floor(10*Math.random()),isPseudo:!0},lens:e,lensesQuant:1}])}));A(null)}},addLensesDiscount:function(e,t){if(""===t){var n=L.map((function(t,n){return e===n?Object.keys(t.discount).length>1?(delete t.discount.lenses,t):(delete t.discount,t):t}));C(n)}else{var c=L.map((function(n,c){return e===c?Object(s.a)(Object(s.a)({},n),{},{discount:Object(s.a)(Object(s.a)({},n.discount),{},{lenses:{percent:t}})}):n}));C(c)}},resetOrder:function(){Q({})},changeStep:J,selectProduct:function(e,t){A(T===e?null:e)},createCombinedProducts:_,incrementQuantity:function(e,t,n){n.stopPropagation();var c=L.map((function(n,c){return t===c?Object(s.a)(Object(s.a)({},n),{},{lensesQuant:e+1}):n}));C(c)},decrementQuantity:function(e,t,n){if(n.stopPropagation(),1!==e){var c=L.map((function(n,c){return t===c?Object(s.a)(Object(s.a)({},n),{},{lensesQuant:e-1}):n}));C(c)}}},children:t})}}}]);
//# sourceMappingURL=24.d20809aa.chunk.js.map