(this.webpackJsonpimooptik=this.webpackJsonpimooptik||[]).push([[25],{57:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var c=n(22);var r=n(33);function o(t){return function(t){if(Array.isArray(t))return Object(c.a)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(r.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},67:function(t,e,n){"use strict";n.r(e),n.d(e,"OrderContext",(function(){return p}));var c=n(2),r=n(8),o=n.n(r),a=n(12),u=n(31),s=n(57),i=n(13),d=n(5),f=n(1),l=n(19),b=n(20),p=Object(f.createContext)({step:"",order:{},cart:[],selectedProduct:null,setOrder:function(){},addUser:function(){},addProduct:function(){},addProductDiscount:function(){},addLensesParameters:function(){},deleteProduct:function(){},addLenses:function(){},addLensesDiscount:function(){},resetOrder:function(){},changeStep:function(){},selectProduct:function(){},createCombinedProducts:function(){},incrementQuantity:function(){},decrementQuantity:function(){},incrementProductQuantity:function(){},decrementProductQuantity:function(){}});e.default=function(t){var e=t.children,n=Object(f.useContext)(b.a).token,r=Object(f.useContext)(l.a),O=r.closeModal,j=r.getMessage,m=r.setIsLoading,P=r.setShowModal,h=Object(f.useState)("select-user"),y=Object(d.a)(h,2),v=y[0],Q=y[1],g=Object(f.useState)({}),k=Object(d.a)(g,2),S=k[0],x=k[1],w=Object(f.useState)([]),L=Object(d.a)(w,2),C=L[0],M=L[1],A=Object(f.useState)(null),D=Object(d.a)(A,2),T=D[0],E=D[1],I=function(t){x(Object(i.a)(Object(i.a)({},S),{},{combinedProducts:Object(s.a)(t)}))},J=function(t){Q(t)},_=function(){var t=Object(a.a)(o.a.mark((function t(){var e,c,r,a,u,d;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==C.length){t.next=2;break}return t.abrupt("return");case 2:return m(!0),P(!0),e=[],C.forEach((function(t){Object(s.a)(Array(t.productQuant)).forEach((function(){e.push(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({product:t.product.isPseudo?"pseudo":t.product._id},t.discount&&{discount:Object(i.a)({},t.discount)}),t.lens&&{lens:t.lens._id}),t.lensesQuant&&{lensesQuant:t.lensesQuant}),t.lenses&&{contactLenses:t.lenses}))}))})),(c=new Headers).append("auth-token",n),c.append("Content-Type","application/json"),r=JSON.stringify({combinedProducts:e}),a={method:"POST",headers:c,body:r,redirect:"follow"},t.prev=11,t.next=14,fetch("".concat("https://imooptik-backend-jbuievsjdq-ew.a.run.app","/api/store/combinedProducts/createMany"),a);case 14:return u=t.sent,t.next=17,u.json();case 17:if(!(d=t.sent).combinedProducts){t.next=23;break}return I(d.combinedProducts),O(),J("summary"),t.abrupt("return");case 23:m(!1),j(d.messageSK),t.next=32;break;case 27:t.prev=27,t.t0=t.catch(11),console.log(t.t0),j("Nieco sa pokazilo"),m(!1);case 32:case"end":return t.stop()}}),t,null,[[11,27]])})));return function(){return t.apply(this,arguments)}}();return Object(c.jsx)(p.Provider,{value:{step:v,order:S,cart:C,selectedProduct:T,setOrder:x,addUser:function(t){x(Object(i.a)(Object(i.a)({},S),{},{user:t}))},addProduct:function(t){M((function(e){return[].concat(Object(s.a)(e),[{product:t,productQuant:1}])}))},addProductDiscount:function(t,e,n){if(""===n){var c=C.map((function(e,n){return t===n?Object.keys(e.discount).length>1?(delete e.discount.product,e):(delete e.discount,e):e}));M(c)}else{var r=C.map((function(c,r){return t===r?Object(i.a)(Object(i.a)({},c),{},{discount:{product:Object(u.a)({},e,n)}}):c}));M(r)}},addLensesParameters:function(t,e){var n=C.map((function(n,c){return t===c&&Object.keys(e).length>0?Object(i.a)(Object(i.a)({},n),{},{lenses:Object(i.a)({},e)}):n}));M(n)},deleteProduct:function(t,e){var n=C.filter((function(e,n){return n!==t}));M(n),e&&setTimeout((function(){e(null)}),100)},addLenses:function(t){if(null!==t||null!==T){if(null!==T){var e=C.map((function(e,n){return n===T?null===t?(delete e.lensesQuant,delete e.lens,e):Object(i.a)(Object(i.a)({},e),{},{lens:t,lensesQuant:2}):e}));M(e)}else M((function(e){return[].concat(Object(s.a)(e),[{product:{_id:Math.floor(10*Math.random()),isPseudo:!0},lens:t,lensesQuant:1}])}));E(null)}},addLensesDiscount:function(t,e){if(""===e){var n=C.map((function(e,n){return t===n?Object.keys(e.discount).length>1?(delete e.discount.lenses,e):(delete e.discount,e):e}));M(n)}else{var c=C.map((function(n,c){return t===c?Object(i.a)(Object(i.a)({},n),{},{discount:Object(i.a)(Object(i.a)({},n.discount),{},{lenses:{percent:e}})}):n}));M(c)}},resetOrder:function(){x({})},changeStep:J,selectProduct:function(t,e){E(T===t?null:t)},createCombinedProducts:_,incrementQuantity:function(t,e,n){n.stopPropagation();var c=C.map((function(n,c){return e===c?Object(i.a)(Object(i.a)({},n),{},{lensesQuant:t+1}):n}));M(c)},decrementQuantity:function(t,e,n){if(n.stopPropagation(),1!==t){var c=C.map((function(n,c){return e===c?Object(i.a)(Object(i.a)({},n),{},{lensesQuant:t-1}):n}));M(c)}},incrementProductQuantity:function(t,e,n){n.stopPropagation();var c=C.map((function(n,c){return e===c?Object(i.a)(Object(i.a)({},n),{},{productQuant:t+1}):n}));M(c)},decrementProductQuantity:function(t,e,n){if(n.stopPropagation(),1!==t){var c=C.map((function(n,c){return e===c?Object(i.a)(Object(i.a)({},n),{},{productQuant:t-1}):n}));M(c)}}},children:e})}}}]);
//# sourceMappingURL=25.1f69134b.chunk.js.map