(this.webpackJsonpimooptik=this.webpackJsonpimooptik||[]).push([[25],{57:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var c=n(22);var r=n(33);function o(e){return function(e){if(Array.isArray(e))return Object(c.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(r.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},67:function(e,t,n){"use strict";n.r(t),n.d(t,"OrderContext",(function(){return p}));var c=n(2),r=n(8),o=n.n(r),a=n(12),u=n(31),s=n(57),i=n(13),d=n(5),l=n(1),f=n(19),b=n(20),p=Object(l.createContext)({step:"",order:{},cart:[],selectedProduct:null,setOrder:function(){},addUser:function(){},addProduct:function(){},addProductDiscount:function(){},addLensesParameters:function(){},deleteProduct:function(){},addLenses:function(){},addLensesDiscount:function(){},resetOrder:function(){},changeStep:function(){},selectProduct:function(){},createCombinedProducts:function(){},incrementQuantity:function(){},decrementQuantity:function(){}});t.default=function(e){var t=e.children,n=Object(l.useContext)(b.a).token,r=Object(l.useContext)(f.a),O=r.closeModal,j=r.getMessage,m=r.setIsLoading,h=r.setShowModal,P=Object(l.useState)("select-user"),v=Object(d.a)(P,2),y=v[0],k=v[1],g=Object(l.useState)({}),S=Object(d.a)(g,2),Q=S[0],x=S[1],w=Object(l.useState)([]),L=Object(d.a)(w,2),C=L[0],M=L[1],D=Object(l.useState)(null),T=Object(d.a)(D,2),A=T[0],I=T[1],J=function(e){x(Object(i.a)(Object(i.a)({},Q),{},{combinedProducts:Object(s.a)(e)}))},_=function(e){k(e)},N=function(){var e=Object(a.a)(o.a.mark((function e(){var t,c,r,a,u,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==C.length){e.next=2;break}return e.abrupt("return");case 2:return m(!0),h(!0),t=C.map((function(e){return Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({product:e.product.isPseudo?"pseudo":e.product._id},e.discount&&{discount:Object(i.a)({},e.discount)}),e.lens&&{lens:e.lens._id}),e.lensesQuant&&{lensesQuant:e.lensesQuant}),e.lenses&&{contactLenses:e.lenses})})),(c=new Headers).append("auth-token",n),c.append("Content-Type","application/json"),r=JSON.stringify({combinedProducts:t}),a={method:"POST",headers:c,body:r,redirect:"follow"},e.prev=10,e.next=13,fetch("".concat("https://imooptik-backend-jbuievsjdq-ew.a.run.app","/api/store/combinedProducts/createMany"),a);case 13:return u=e.sent,e.next=16,u.json();case 16:if(!(s=e.sent).combinedProducts){e.next=22;break}return J(s.combinedProducts),O(),_("summary"),e.abrupt("return");case 22:m(!1),j(s.messageSK),e.next=31;break;case 26:e.prev=26,e.t0=e.catch(10),console.log(e.t0),j("Nieco sa pokazilo"),m(!1);case 31:case"end":return e.stop()}}),e,null,[[10,26]])})));return function(){return e.apply(this,arguments)}}();return Object(c.jsx)(p.Provider,{value:{step:y,order:Q,cart:C,selectedProduct:A,setOrder:x,addUser:function(e){x(Object(i.a)(Object(i.a)({},Q),{},{user:e}))},addProduct:function(e){M((function(t){return[].concat(Object(s.a)(t),[{product:e}])}))},addProductDiscount:function(e,t,n){if(""===n){var c=C.map((function(t,n){return e===n?Object.keys(t.discount).length>1?(delete t.discount.product,t):(delete t.discount,t):t}));M(c)}else{var r=C.map((function(c,r){return e===r?Object(i.a)(Object(i.a)({},c),{},{discount:{product:Object(u.a)({},t,n)}}):c}));M(r)}},addLensesParameters:function(e,t){var n=C.map((function(n,c){return e===c&&Object.keys(t).length>0?Object(i.a)(Object(i.a)({},n),{},{lenses:Object(i.a)({},t)}):n}));M(n)},deleteProduct:function(e,t){var n=C.filter((function(t,n){return n!==e}));M(n),t&&setTimeout((function(){t(null)}),100)},addLenses:function(e){if(null!==e||null!==A){if(null!==A){var t=C.map((function(t,n){return n===A?null===e?(delete t.lensesQuant,delete t.lens,t):Object(i.a)(Object(i.a)({},t),{},{lens:e,lensesQuant:2}):t}));M(t)}else M((function(t){return[].concat(Object(s.a)(t),[{product:{_id:Math.floor(10*Math.random()),isPseudo:!0},lens:e,lensesQuant:1}])}));I(null)}},addLensesDiscount:function(e,t){if(""===t){var n=C.map((function(t,n){return e===n?Object.keys(t.discount).length>1?(delete t.discount.lenses,t):(delete t.discount,t):t}));M(n)}else{var c=C.map((function(n,c){return e===c?Object(i.a)(Object(i.a)({},n),{},{discount:Object(i.a)(Object(i.a)({},n.discount),{},{lenses:{percent:t}})}):n}));M(c)}},resetOrder:function(){x({})},changeStep:_,selectProduct:function(e,t){I(A===e?null:e)},createCombinedProducts:N,incrementQuantity:function(e,t,n){n.stopPropagation();var c=C.map((function(n,c){return t===c?Object(i.a)(Object(i.a)({},n),{},{lensesQuant:e+1}):n}));M(c)},decrementQuantity:function(e,t,n){if(n.stopPropagation(),1!==e){var c=C.map((function(n,c){return t===c?Object(i.a)(Object(i.a)({},n),{},{lensesQuant:e-1}):n}));M(c)}}},children:t})}}}]);
//# sourceMappingURL=25.a4967136.chunk.js.map