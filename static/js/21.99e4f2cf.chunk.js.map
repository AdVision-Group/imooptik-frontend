{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","context/order/order.context.jsx"],"names":["_toConsumableArray","arr","Array","isArray","arrayLikeToArray","iter","Symbol","iterator","Object","from","unsupportedIterableToArray","TypeError","OrderContext","createContext","step","order","cart","selectedProduct","setOrder","addUser","addProduct","addProductDiscount","addLensesParameters","deleteProduct","addLenses","addLensesDiscount","resetOrder","changeStep","selectProduct","createCombinedProducts","OrderProvider","children","token","useContext","AuthContext","LoadingModalContext","getMessage","closeModal","setIsLoading","setShowModal","useState","setStep","setCart","setSelectedProduct","a","console","log","combinedProductsArr","map","item","product","_id","discount","lens","lensesQuant","lenses","user","contactLenses","myHeaders","Headers","append","raw","JSON","stringify","requestOptions","method","headers","body","redirect","fetch","process","response","json","data","messageSK","Provider","value","productObj","prevValue","idx","newCart","index","keys","length","lensesObj","filter","newStepString","productIdx"],"mappings":"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","file":"static/js/21.99e4f2cf.chunk.js","sourcesContent":["import arrayWithoutHoles from \"@babel/runtime/helpers/esm/arrayWithoutHoles\";\nimport iterableToArray from \"@babel/runtime/helpers/esm/iterableToArray\";\nimport unsupportedIterableToArray from \"@babel/runtime/helpers/esm/unsupportedIterableToArray\";\nimport nonIterableSpread from \"@babel/runtime/helpers/esm/nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"@babel/runtime/helpers/esm/arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import React, { createContext, useState, useContext } from 'react'\nimport { LoadingModalContext } from '../loading-modal/loading-modal.contenxt'\nimport { AuthContext } from '../auth/auth.context'\n\nexport const OrderContext = createContext({\n    step: \"\",\n    order: {},\n    cart: [],\n    selectedProduct: null,\n    setOrder: () => { },\n    addUser: () => { },\n    addProduct: () => { },\n    addProductDiscount: () => { },\n    addLensesParameters: () => { },\n    deleteProduct: () => { },\n    addLenses: () => { },\n    addLensesDiscount: () => { },\n    resetOrder: () => { },\n    changeStep: () => { },\n    selectProduct: () => { },\n    createCombinedProducts: () => { }\n})\n\nconst OrderProvider = ({ children }) => {\n    const { token } = useContext(AuthContext)\n    const { closeModal, getMessage, setIsLoading, setShowModal } = useContext(LoadingModalContext)\n    const [step, setStep] = useState('select-user')\n    const [order, setOrder] = useState({})\n    const [cart, setCart] = useState([])\n    const [selectedProduct, setSelectedProduct] = useState(null)\n\n    const addUser = (user) => {\n        setOrder({\n            ...order,\n            user: user\n        })\n    }\n\n    const selectProduct = productIdx => {\n        setSelectedProduct(productIdx)\n    }\n\n    const addProduct = (productObj) => {\n        setCart(prevValue => [\n            ...prevValue,\n            { product: productObj, }\n        ])\n    }\n\n    const addProductDiscount = (idx, value) => {\n        if (value === \"\") {\n            const newCart = cart.map((item, index) => {\n                if (idx === index) {\n                    if (Object.keys(item.discount).length > 1) {\n                        delete item.discount[\"product\"]\n                        return item\n                    } else {\n                        delete item[\"discount\"]\n                        return item\n                    }\n                } else {\n                    return item\n                }\n            })\n            setCart(newCart)\n        } else {\n            const newCart = cart.map((item, index) => {\n                if (idx === index) {\n                    return {\n                        ...item,\n                        discount: {\n                            product: value\n                        }\n                    }\n                } else {\n                    return item\n                }\n            })\n            setCart(newCart)\n        }\n    }\n\n    const addLensesParameters = (idx, lensesObj) => {\n        const newCart = cart.map((item, index) => {\n            if (idx === index) {\n                if (Object.keys(lensesObj).length > 0) {\n                    return {\n                        ...item,\n                        lenses: {\n                            ...lensesObj\n                        }\n                    }\n                } else {\n                    return item\n                }\n            } else {\n                return item\n            }\n        })\n        setCart(newCart)\n    }\n\n    const deleteProduct = (productObj) => {\n        console.log(productObj)\n        const newCart = cart.filter(item => item.product._id !== productObj.product._id)\n        setCart(newCart)\n    }\n\n    const addLenses = (lensesObj) => {\n        if (selectedProduct !== null) {\n            const newCart = cart.map((item, idx) => {\n                if (idx === selectedProduct) {\n                    return ({\n                        ...item,\n                        lens: lensesObj\n                    })\n                } else {\n                    return item\n                }\n            })\n            setCart(newCart)\n        } else {\n            setCart(prevValue => [\n                ...prevValue,\n                {\n                    product: {\n                        _id: 'pseudo'\n                    },\n                    lens: lensesObj,\n                }\n            ])\n        }\n\n        setSelectedProduct(null)\n    }\n\n\n    const addLensesDiscount = (idx, value) => {\n        if (value === \"\") {\n            const newCart = cart.map((item, index) => {\n                if (idx === index) {\n                    if (Object.keys(item.discount).length > 1) {\n                        delete item.discount[\"lenses\"]\n                        return item\n                    } else {\n                        delete item[\"discount\"]\n                        return item\n                    }\n                } else {\n                    return item\n                }\n            })\n            setCart(newCart)\n        } else {\n            const newCart = cart.map((item, index) => {\n                if (idx === index) {\n                    return {\n                        ...item,\n                        discount: {\n                            ...item.discount,\n                            lenses: value\n                        }\n                    }\n                } else {\n                    return item\n                }\n            })\n            setCart(newCart)\n        }\n    }\n\n    const resetOrder = () => {\n        setOrder({})\n    }\n\n    const changeStep = (newStepString) => {\n        setStep(newStepString)\n    }\n\n    const createCombinedProducts = async () => {\n        setIsLoading(true)\n        setShowModal(true)\n        console.log(\"ORIGINAL CART\")\n        console.log(cart)\n\n        const combinedProductsArr = cart.map(item => ({\n            product: item.product._id,\n            ...(item.discount) && { discount: { ...item.discount } },\n            ...(item.lens) && { lens: item.lens._id },\n            ...(item.lens) && { lensesQuant: 1 },\n            ...(item.lens) && { lenses: order.user.lenses },\n            ...(item.lenses) && { contactLenses: item.lenses }\n        }))\n\n        console.log(\"FORMATED CART\")\n        console.log(combinedProductsArr)\n\n        const myHeaders = new Headers();\n        myHeaders.append(\"auth-token\", token);\n\n        const raw = JSON.stringify(combinedProductsArr)\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n            redirect: 'follow'\n        };\n\n        try {\n            // /api/store/combinedProducts/createMany\n            const response = await fetch(`${process.env.REACT_APP_BACKEND_ENDPOINT}/api/store/combinedProducts/createMany`, requestOptions)\n            const data = await response.json()\n\n            console.log(data)\n\n            setIsLoading(false)\n            getMessage(data.messageSK)\n        } catch (err) {\n            console.log(err)\n            getMessage(\"Nieco sa pokazilo\")\n            setIsLoading(false)\n        }\n    }\n\n    return (\n        <OrderContext.Provider\n            value={{\n                step,\n                order,\n                cart,\n                selectedProduct,\n                setOrder,\n                addUser,\n                addProduct,\n                addProductDiscount,\n                addLensesParameters,\n                deleteProduct,\n                addLenses,\n                addLensesDiscount,\n                resetOrder,\n                changeStep,\n                selectProduct,\n                createCombinedProducts,\n            }}\n        >\n            {children}\n        </OrderContext.Provider>\n    )\n}\n\nexport default OrderProvider"],"sourceRoot":""}